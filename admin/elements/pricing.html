<!doctype html>
<html lang="en">
<head>
    <title>Pricing Plans - The CodeGrammer</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/assets/images/app_config/favicon.webp" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://agency.thecodegrammer.net/static/dashboard/assets/fonts/phosphor/duotone/style.css" />
    <link rel="stylesheet" href="https://agency.thecodegrammer.net/static/dashboard/assets/fonts/tabler-icons.min.css" />
    <link rel="stylesheet" href="https://agency.thecodegrammer.net/static/dashboard/assets/css/style.css" id="main-style-link" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <style>
        .page-container { max-width: 1200px; margin: 50px auto; padding: 20px; }
        .page-header { background: linear-gradient(135deg, #1a1f36 0%, #2d3450 100%); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
        .page-header h1 { margin: 0; font-size: 28px; }
        .page-header .breadcrumb { display: flex; gap: 10px; margin-bottom: 10px; }
        .page-header .breadcrumb a { color: rgba(255,255,255,0.7); text-decoration: none; }
        .page-header .breadcrumb a:hover { color: white; }
        .page-header .breadcrumb span { color: rgba(255,255,255,0.5); }
        .btn-add { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); color: white; border: none; padding: 12px 25px; border-radius: 8px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; text-decoration: none; transition: all 0.2s; }
        .btn-add:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(72,187,120,0.4); color: white; }
        .pricing-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; }
        .pricing-card { background: var(--bs-card-bg, #fff); border-radius: 12px; overflow: hidden; box-shadow: 0 2px 15px rgba(0,0,0,0.08); position: relative; transition: transform 0.2s, box-shadow 0.2s; }
        .pricing-card:hover { transform: translateY(-5px); box-shadow: 0 8px 30px rgba(0,0,0,0.12); }
        .pricing-card.featured { border: 2px solid #f59e0b; }
        .pricing-card .featured-badge { position: absolute; top: 15px; right: 15px; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .pricing-card-header { background: linear-gradient(135deg, #4680ff 0%, #3575f3 100%); color: white; padding: 25px; text-align: center; }
        .pricing-card.featured .pricing-card-header { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .pricing-card-header h3 { margin: 0 0 5px 0; font-size: 22px; }
        .pricing-card-header .price { font-size: 36px; font-weight: 700; margin: 10px 0; }
        .pricing-card-header .duration { font-size: 14px; opacity: 0.9; }
        .pricing-card-body { padding: 25px; }
        .pricing-card-body ul { list-style: none; padding: 0; margin: 0 0 20px 0; }
        .pricing-card-body li { padding: 8px 0; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 10px; }
        .pricing-card-body li:last-child { border-bottom: none; }
        .pricing-card-body li i { color: #48bb78; }
        .pricing-card-actions { display: flex; gap: 10px; padding: 0 25px 25px 25px; }
        .btn-edit { flex: 1; background: #f1f3f5; color: #5b6b79; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 5px; text-decoration: none; }
        .btn-edit:hover { background: #e9ecef; }
        .btn-delete { background: #fee2e2; color: #dc2626; border: none; padding: 10px 15px; border-radius: 8px; cursor: pointer; }
        .btn-delete:hover { background: #dc2626; color: white; }
        .empty-state { text-align: center; padding: 60px 20px; color: #6b7280; }
        .empty-state i { font-size: 64px; color: #d1d5db; margin-bottom: 20px; }
        .loading { text-align: center; padding: 60px; }
        .loading i { font-size: 48px; color: #4680ff; }
        .toast { position: fixed; top: 20px; right: 20px; padding: 15px 25px; border-radius: 8px; color: white; font-weight: 500; z-index: 9999; animation: slideIn 0.3s ease; }
        .toast.success { background: linear-gradient(135deg, #48bb78 0%, #38a169 100%); }
        .toast.error { background: linear-gradient(135deg, #fc8181 0%, #e53e3e 100%); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body data-pc-preset="preset-1" data-pc-sidebar-theme="light">

<div class="page-container">
    <div class="page-header">
        <div>
            <div class="breadcrumb">
                <a href="/admin/dashboard/index.html"><i class="fas fa-home"></i> Dashboard</a>
                <span>/</span>
                <span>Pricing Plans</span>
            </div>
            <h1><i class="fas fa-tags me-2"></i> Pricing Plans</h1>
        </div>
        <a href="/admin/elements/create-pricing.html" class="btn-add">
            <i class="fas fa-plus"></i> Add New Plan
        </a>
    </div>

    <div id="pricingGrid" class="pricing-grid">
        <div class="loading"><i class="fas fa-spinner fa-spin"></i></div>
    </div>
</div>

<script type="module">
import { supabase } from '../../src/supabase-client.js';

function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>${message}`;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
}

async function loadPricing() {
    const grid = document.getElementById('pricingGrid');
    
    try {
        const { data: plans, error } = await supabase
            .from('pricing_plans')
            .select('*')
            .order('created_at', { ascending: true });
        
        if (error) throw error;
        
        if (!plans || plans.length === 0) {
            grid.innerHTML = `
                <div class="empty-state" style="grid-column: 1/-1;">
                    <i class="fas fa-tags"></i>
                    <h3>No Pricing Plans Yet</h3>
                    <p>Click "Add New Plan" to create your first pricing plan.</p>
                </div>
            `;
            return;
        }
        
        grid.innerHTML = plans.map(plan => {
            const features = (plan.features || '').split('\n').filter(f => f.trim());
            const featuresHtml = features.map(f => `<li><i class="fas fa-check"></i> ${f}</li>`).join('');
            
            return `
                <div class="pricing-card ${plan.is_featured ? 'featured' : ''}" data-id="${plan.id}">
                    ${plan.is_featured ? '<span class="featured-badge"><i class="fas fa-star me-1"></i> Popular</span>' : ''}
                    <div class="pricing-card-header">
                        <h3>${plan.title}</h3>
                        <div class="price">${plan.currency || '$'}${plan.price}</div>
                        <div class="duration">${plan.duration || '/month'}</div>
                    </div>
                    <div class="pricing-card-body">
                        <ul>${featuresHtml}</ul>
                    </div>
                    <div class="pricing-card-actions">
                        <a href="/admin/pages/page-editor.html?page=pricing" class="btn-edit">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <button class="btn-delete" onclick="deletePlan('${plan.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
        }).join('');
        
    } catch (err) {
        console.error(err);
        grid.innerHTML = `<div class="empty-state" style="grid-column: 1/-1;"><i class="fas fa-exclamation-triangle"></i><h3>Error Loading Plans</h3><p>${err.message}</p></div>`;
    }
}

window.deletePlan = async function(id) {
    if (!confirm('Are you sure you want to delete this pricing plan?')) return;
    
    try {
        const { error } = await supabase
            .from('pricing_plans')
            .delete()
            .eq('id', id);
        
        if (error) throw error;
        
        showToast('Pricing plan deleted!', 'success');
        loadPricing();
        
    } catch (err) {
        console.error(err);
        showToast('Failed to delete: ' + err.message, 'error');
    }
};

loadPricing();
</script>

<script type="module" src="/admin/assets/js/auth-guard.js"></script>
</body>
</html>
